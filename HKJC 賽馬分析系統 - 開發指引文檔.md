# ğŸ´ HKJC è³½é¦¬åˆ†æç³»çµ± - é–‹ç™¼æŒ‡å¼•æ–‡æª”

**ç‰ˆæœ¬**: v12.0 (å®Œæ•´æ¨¡çµ„åŒ–é‡æ§‹ç‰ˆ)  
**æœ€å¾Œæ›´æ–°**: 2026-01-09  
**æ¶æ§‹ç‰ˆæœ¬**: System_Architecture_Guide.md å®Œå…¨é…å¥—

---

## ğŸ“‹ ç›®éŒ„

1. [å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½](#å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½)
2. [ç³»çµ±ä¸‰å±¤è¨­è¨ˆ](#ç³»çµ±ä¸‰å±¤è¨­è¨ˆ)
3. [æ ¸å¿ƒæ¨¡çµ„è©³è§£](#æ ¸å¿ƒæ¨¡çµ„è©³è§£)
4. [æ–°å¢åŠŸèƒ½æŒ‡å—](#æ–°å¢åŠŸèƒ½æŒ‡å—)
5. [ä¿®æ”¹ç¾æœ‰åŠŸèƒ½æŒ‡å—](#ä¿®æ”¹ç¾æœ‰åŠŸèƒ½æŒ‡å—)
6. [é–‹ç™¼è¦ç¯„](#é–‹ç™¼è¦ç¯„)
7. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
8. [å¿«é€Ÿåƒè€ƒ](#å¿«é€Ÿåƒè€ƒ)

---

## ğŸ“ å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½

### æœ€æ–°ç›®éŒ„çµæ§‹ (v12.0)

```
hkjc_app/
â”œâ”€â”€ app.py                          # ğŸ  æ‡‰ç”¨ä¸»å…¥å£ (v12.0)
â”‚
â”œâ”€â”€ pages/                          # ğŸ¨ UI å±¤ (6 å€‹é é¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ page_segment.py             # Tab1: åˆ†æ®µæ™‚é–“åˆ†æ
â”‚   â”œâ”€â”€ page_pace.py                # Tab2: æ­¥é€Ÿåˆ†æï¼ˆé ç•™ï¼‰
â”‚   â”œâ”€â”€ page_report.py              # Tab3: å®Œæ•´åˆ†æå ±å‘Š
â”‚   â”œâ”€â”€ page_racecard.py            # Tab4: æ’ä½è¡¨åˆ†æ â­ (v3.6)
â”‚   â”œâ”€â”€ page_pace_prediction.py      # Tab5: è·‘æ³•é æ¸¬ï¼ˆåŸºç¤ç‰ˆï¼‰
â”‚   â””â”€â”€ page_pace_prediction_integrated.py  # Tab5: è·‘æ³•é æ¸¬ï¼ˆè¨ºæ–·ç‰ˆ v2.6ï¼‰â­
â”‚
â”œâ”€â”€ analyzers/                      # ğŸ§  é‚è¼¯å±¤ (12+ æ¨¡çµ„)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_analyzer.py            # åŸºé¡ - å…±ç”¨å‡½æ•¸
â”‚   â”œâ”€â”€ racecard_analyzer.py        # æ’ä½è¡¨åˆ†æ (v2.0) â­
â”‚   â”œâ”€â”€ runstyle_predictor.py       # è·‘æ³•é æ¸¬ (v3.1) â­
â”‚   â”œâ”€â”€ pace_predictor.py           # æ­¥é€Ÿé æ¸¬ â­
â”‚   â”œâ”€â”€ horse_racing_history_parser.py  # å¾€ç¸¾çˆ¬èŸ² â­
â”‚   â”œâ”€â”€ race_details_extractor.py   # è³½æ¬¡æå–
â”‚   â”œâ”€â”€ race_crawler.py             # è³½æ¬¡çˆ¬èŸ²
â”‚   â”œâ”€â”€ report_analyzer.py          # å ±å‘Šç”Ÿæˆ
â”‚   â”œâ”€â”€ standard_times_lookup.py    # æ¨™æº–æ™‚é–“æŸ¥è©¢
â”‚   â”œâ”€â”€ pace_analysis.py            # æ­¥é€Ÿåˆ†æå·¥å…·
â”‚   â”œâ”€â”€ hkjc_sectional.py           # åˆ†æ®µæ™‚é–“å·¥å…·
â”‚   â””â”€â”€ horse_racing_html_analyzer.py  # HTML åˆ†æå·¥å…·
â”‚
â””â”€â”€ [å…¶ä»–å·¥å…·]
    â”œâ”€â”€ run_crawler.py              # çˆ¬èŸ²å•Ÿå‹•å™¨
    â””â”€â”€ [æ•¸æ“šæ–‡ä»¶]
```

**â­ æ¨™è¨˜ = æ ¸å¿ƒæ¨¡çµ„ (æ–°çš„æˆ–é‡é»ä¿®æ”¹)**

---

## ğŸ¯ ç³»çµ±ä¸‰å±¤è¨­è¨ˆ

### æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI å±¤ (pages/)                         â”‚
â”‚    - page_segment.py      (åˆ†æ®µåˆ†æ)                 â”‚
â”‚    - page_report.py       (å®Œæ•´å ±å‘Š)                 â”‚
â”‚    - page_racecard.py     (æ’ä½è¡¨ v3.6) â­          â”‚
â”‚    - page_pace_prediction* (è·‘æ³•é æ¸¬ v2.6) â­       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“â†‘ (æ•¸æ“š + å‡½æ•¸èª¿ç”¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é‚è¼¯å±¤ (analyzers/)                        â”‚
â”‚    - RaceCardAnalyzer (v2.0) â­                    â”‚
â”‚    - RunstylePredictor (v3.1) â­                   â”‚
â”‚    - PacePredictor                                 â”‚
â”‚    - HorseRacingHistoryParser â­                   â”‚
â”‚    - å…¶ä»– 8+ åˆ†æå™¨                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“â†‘ (çˆ¬èŸ²æ•¸æ“š)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       æ•¸æ“šå±¤ (HKJC å®˜æ–¹ç¶²ç«™)                        â”‚
â”‚    - æ’ä½è¡¨ (27 æ¬„)                                 â”‚
â”‚    - é¦¬åŒ¹å¾€ç¸¾ (17 æ¬„)                               â”‚
â”‚    - è³½äº‹ä¿¡æ¯                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±¤è¨­è¨ˆåŸå‰‡

| å±¤ç´š | æª”æ¡ˆ | è·è²¬ | é‡é» |
|------|------|------|------|
| **å…¥å£å±¤** | `app.py` | è·¯ç”± + å…±ç”¨æ•¸æ“š | 5 å€‹ Tab å…¥å£ |
| **UI å±¤** | `pages/*.py` | ç”¨æˆ¶äº¤äº’ + å±•ç¤º | ä¾è³´é‚è¼¯å±¤ |
| **é‚è¼¯å±¤** | `analyzers/*.py` | æ•¸æ“šåˆ†æ + é æ¸¬ | **æ ¸å¿ƒç®—æ³•** |
| **æ•¸æ“šå±¤** | å¤–éƒ¨ç¶²çµ¡ | çˆ¬èŸ²æ•¸æ“šæº | HKJC å®˜ç¶² |

---

## ğŸ” æ ¸å¿ƒæ¨¡çµ„è©³è§£

### â­ ã€é‡é»ã€‘Module 1: page_racecard.py (v3.6)

**ä½ç½®**: `pages/page_racecard.py`

**åŠŸèƒ½**: æ’ä½è¡¨åˆ†æ + é¦¬åŒ¹å¾€ç¸¾ + è·‘æ³•é æ¸¬é›†æˆ

**é—œéµä¿®å¾© (v3.6)**:
```python
def clear_predictions():
    """æ¸…é™¤èˆŠçš„é æ¸¬æ•¸æ“š - v3.1 ä¿®å¾©"""
    st.session_state.pop('pace_predictions', None)
    st.session_state.pop('pace_modified_predictions', None)

# ä½¿ç”¨ä½ç½®
if fetch_button:
    clear_predictions()  # â† å¿…é ˆï¼è§£æ±ºå¤šå ´æ¬¡é‡è¤‡é æ¸¬
    result = analyzer.fetch_racecard(...)
```

**ä½•æ™‚ä¿®æ”¹**: 
- èª¿æ•´æ’ä½è¡¨é¡¯ç¤ºæ¬„ä½
- ä¿®æ”¹å¾€ç¸¾çˆ¬å–åƒæ•¸
- æ›´æ–°é æ¸¬çµæœå±•ç¤º

**é¢¨éšªç­‰ç´š**: ğŸŸ¡ **ä¸­é¢¨éšª** - å½±éŸ¿æ•´å€‹æ’ä½è¡¨åˆ†ææµç¨‹

**ä¿®æ”¹å‰æª¢æŸ¥**:
- [ ] ç¢ºèª clear_predictions() æœ‰è¢«èª¿ç”¨
- [ ] å¾€ç¸¾çˆ¬èŸ²æ˜¯å¦é‚„èƒ½æ­£å¸¸å·¥ä½œ
- [ ] é æ¸¬çµæœæ˜¯å¦æ­£ç¢ºé¡¯ç¤º

---

### â­ ã€é‡é»ã€‘Module 2: RaceCardAnalyzer (v2.0)

**ä½ç½®**: `analyzers/racecard_analyzer.py`

**åŠŸèƒ½**: 
- çˆ¬å–æ’ä½è¡¨ï¼ˆå…§éƒ¨ 27 æ¬„ï¼Œå¤–éƒ¨ 17 æ¬„ï¼‰
- é›†æˆé¦¬åŒ¹å¾€ç¸¾çˆ¬èŸ²
- è¿”å›å®Œæ•´é¦¬åŒ¹æ•¸æ“š

**æ ¸å¿ƒæ–¹æ³•**:
```python
def fetch_racecard(self, date_str, racecourse, race_no,
                  fetch_history=True, max_races=6):
    """
    çˆ¬å–æ’ä½è¡¨ + å¾€ç¸¾
    
    è¼¸å‡º: {
        'race_id': 'HV_20260107_1',
        'horses': [12éš»é¦¬çš„å®Œæ•´æ•¸æ“š],
        'total_horses': 12
    }
    """
```

**æ¬„ä½èªªæ˜**:
- **å…§éƒ¨ 27 æ¬„**: æ‰€æœ‰åŸå§‹é¦¬åŒ¹æ•¸æ“š
- **å¤–éƒ¨ 17 æ¬„**: ç”¨æˆ¶çœ‹åˆ°çš„é¡¯ç¤ºæ¬„ä½
- **å¾€ç¸¾ 17 æ¬„**: æ¯éš»é¦¬çš„æ­·å²ç´€éŒ„

**ä½•æ™‚ä¿®æ”¹**: 
- é¦¬æœƒç¶²ç«™æ”¹ç‰ˆ
- éœ€è¦çˆ¬å–æ–°çš„æ¬„ä½
- å¾€ç¸¾çˆ¬èŸ²é‚è¼¯èª¿æ•´

**é¢¨éšªç­‰ç´š**: ğŸ”´ **é«˜é¢¨éšª** - å½±éŸ¿æ•´å€‹æ’ä½è¡¨ç²å–

**ä¿®æ”¹å‰æª¢æŸ¥**:
- [ ] æ¸¬è©¦çˆ¬èŸ²æ˜¯å¦èƒ½æ­£ç¢ºè­˜åˆ¥ HTML
- [ ] é©—è­‰å¾€ç¸¾çˆ¬å–æ•¸æ“šæ ¼å¼
- [ ] ç¢ºèª 27 æ¬„æ˜¯å¦éƒ½æ­£ç¢ºæå–

---

### â­ ã€é‡é»ã€‘Module 3: RunstylePredictor (v3.1)

**ä½ç½®**: `analyzers/runstyle_predictor.py`

**åŠŸèƒ½**: é æ¸¬é¦¬åŒ¹è·‘æ³• (FRONT / MID / BACK)

**æ ¸å¿ƒç®—æ³• (5 æ­¥)**:
```
Step 1: è¨ˆç®—åŸºæº–ä½ç½® = å¾€ç¸¾æ—©æ®µä½ç½®çš„å¹³å‡å€¼
Step 2: æª”ä½ä¿®æ­£ = æ ¹æ“šæª”ä½è™Ÿç¢¼ (-0.5 / 0 / +1.5)
Step 3: èª¿æ•´ä½ç½® = åŸºæº–ä½ç½® + æª”ä½ä¿®æ­£
Step 4: åˆ†é¡ = 
    â‰¤2.5   â†’ FRONT (é ˜æ”¾)
    2.5-6.5 â†’ MID   (ä¸­ç½®)
    >6.5   â†’ BACK   (ç•™å¾Œ)
Step 5: ä¿¡å¿ƒåº¦ = æ ¹æ“šå¾€ç¸¾æ•¸ + æ¨™æº–å·®è¨ˆç®—
```

**è¼¸å…¥æ ¼å¼**:
```python
horse_data = {
    'horse_number': 1,
    'horse_name': 'å‡Œé¢¨å‚²é›ª',
    'draw': 12,  # æª”ä½
    'distance': 1200,
    'history': [
        {
            'distance': 1200,
            'running_path': '1 5 1 8 12 2',  # æ²¿é€”èµ°ä½ â­ é—œéµ
            ...
        }
    ]
}
```

**ä½•æ™‚ä¿®æ”¹**:
- èª¿æ•´æª”ä½ä¿®æ­£å€¼
- ä¿®æ”¹åˆ†é¡é‚Šç•Œ
- æ”¹é€²ä¿¡å¿ƒåº¦è¨ˆç®—

**é¢¨éšªç­‰ç´š**: ğŸ”´ **é«˜é¢¨éšª** - å½±éŸ¿è·‘æ³•é æ¸¬æº–ç¢ºåº¦

**ä¿®æ”¹å‰æª¢æŸ¥**:
- [ ] æ²¿é€”èµ°ä½æ˜¯å¦æ­£ç¢ºè§£æ
- [ ] åˆ†é¡é‚Šç•Œæ˜¯å¦åˆç†
- [ ] æ¸¬è©¦å¤šå€‹é¦¬åŒ¹çš„é æ¸¬çµæœ

---

### â­ ã€é‡é»ã€‘Module 4: HorseRacingHistoryParser

**ä½ç½®**: `analyzers/horse_racing_history_parser.py`

**åŠŸèƒ½**: çˆ¬å–å–®éš»é¦¬çš„å¾€ç¸¾ç´€éŒ„

**å¾€ç¸¾æ¬„ä½ (17 æ¬„)**:
```
date, position (åæ¬¡), distance (é€”ç¨‹), condition (å ´åœ°),
race_class (ç­æ¬¡), barrier (æª”ä½), rating (è©•åˆ†), trainer (ç·´é¦¬å¸«),
jockey (é¨å¸«), winning_distance (é ­é¦¬è·é›¢), win_odds (ç¨è´),
actual_weight (å¯¦éš›è² ç£…), going (æ²¿é€”èµ°ä½) â­,
finishing_time (å®Œæˆæ™‚é–“), stable_weight (æ’ä½é«”é‡), gear (é…å‚™), remarks
```

**æœ€é‡è¦çš„æ¬„ä½**: `going` (æ²¿é€”èµ°ä½)
- æ ¼å¼: "1 5 1 8 12 2" (ç¬¬ä¸€å€‹æ•¸å­— = æ—©æ®µä½ç½®)
- ç”¨é€”: ç”¨æ–¼è¨ˆç®—è·‘æ³•åŸºæº–ä½ç½®

**ä½•æ™‚ä¿®æ”¹**:
- å¾€ç¸¾çˆ¬èŸ²å¤±æ•—
- éœ€è¦æ–°å¢å¾€ç¸¾æ¬„ä½
- é¦¬æœƒç¶²ç«™æ”¹ç‰ˆ

**é¢¨éšªç­‰ç´š**: ğŸ”´ **é«˜é¢¨éšª** - ç›´æ¥å½±éŸ¿è·‘æ³•é æ¸¬

---

### ğŸŸ¡ Module 5: page_pace_prediction_integrated.py (v2.6)

**ä½ç½®**: `pages/page_pace_prediction_integrated.py`

**åŠŸèƒ½**: é›†æˆçš„è·‘æ³•é æ¸¬é é¢ï¼ˆè¨ºæ–·å¼·åŒ–ç‰ˆï¼‰

**ä¸‰éƒ¨åˆ†**:
1. **Part 1**: é¦¬åŒ¹è·‘æ³•é æ¸¬ (èª¿ç”¨ RunstylePredictor)
2. **Part 2**: é¦¬ç¾¤é…ç½®åˆ†æ (FRONT/MID/BACK åˆ†ä½ˆ)
3. **Part 3**: æ•´å ´æ­¥é€Ÿé æ¸¬ (èª¿ç”¨ PacePredictor)

**é—œéµç‰¹æ€§**:
- ğŸ” æ·±åº¦è¨ºæ–·ä¿¡æ¯å±•ç¤º
- ğŸ“Š æ¯éš»é¦¬çš„é æ¸¬éç¨‹è¿½è¹¤
- âš ï¸ å®Œæ•´çš„éŒ¯èª¤å ±å‘Š
- ğŸ“ˆ å¾€ç¸¾æ•¸æ“šçµ±è¨ˆ

**è³‡æ–™è½‰æ›** (æœ€é—œéµéƒ¨åˆ†):
```python
# è¼¸å…¥ (ä¾†è‡ªçˆ¬èŸ²)
horse {
    'barrier': '12',  # å­—ç¬¦ä¸²
    'racing_history': [
        {'going': '1 5 1 8 12 2'}
    ]
}

# è½‰æ›ç‚ºé æ¸¬å™¨æ ¼å¼
horse_data = {
    'draw': int('12'),  # â­ è½‰ç‚ºæ•´æ•¸
    'history': [
        {'running_path': '1 5 1 8 12 2'}  # â­ å­—æ®µé‡å‘½å
    ]
}

# é æ¸¬çµæœ
{
    'running_style': 'MID',
    'adjusted_position': 6.28,
    'confidence': 90
}
```

**ä½•æ™‚ä¿®æ”¹**:
- èª¿æ•´è¨ºæ–·ä¿¡æ¯çš„å±•ç¤º
- ä¿®æ”¹ä¸‰éƒ¨åˆ†çš„ UI å¸ƒå±€
- æ–°å¢åˆ†ææŒ‡æ¨™

**é¢¨éšªç­‰ç´š**: ğŸŸ¢ **ä½é¢¨éšª** - UI å±¤çš„æ”¹å‹•

---

### ğŸŸ¢ Module 6: PacePredictor

**ä½ç½®**: `analyzers/pace_predictor.py`

**åŠŸèƒ½**: æ ¹æ“šé¦¬ç¾¤é…ç½®é æ¸¬æ•´å ´æ­¥é€Ÿ

**é æ¸¬é‚è¼¯**:
```
å‰ç½®é¦¬æ•¸é‡ â‰¥ 4  â†’ å¿«é€Ÿæ­¥é€Ÿ
å‰ç½®é¦¬æ•¸é‡ 2-3 â†’ ä¸­ç­‰åå¿«
å‰ç½®é¦¬æ•¸é‡ â‰¤ 1 + å¾Œç½®é¦¬å¤š â†’ æ…¢é€Ÿæ­¥é€Ÿ
å…¶ä»–æ··åˆ â†’ ä¸­ç­‰æ­¥é€Ÿ
```

**ä½•æ™‚ä¿®æ”¹**: èª¿æ•´æ­¥é€Ÿé æ¸¬çš„åˆ¤å®šè¦å‰‡

**é¢¨éšªç­‰ç´š**: ğŸŸ¢ **ä½é¢¨éšª** - ç¨ç«‹é æ¸¬å™¨

---

## â• æ–°å¢åŠŸèƒ½æŒ‡å—

### æ–¹æ¡ˆ Aï¼šæ–°å¢ç¨ç«‹ Tabï¼ˆæ¨è–¦ï¼‰

**é©ç”¨**: å…¨æ–°åŠŸèƒ½ï¼Œèˆ‡ç¾æœ‰åŠŸèƒ½ç„¡é—œ

**æ­¥é©Ÿ**:

1. **å»ºç«‹åˆ†æå™¨** (å¦‚éœ€è¦)
```bash
mkdir -p analyzers
touch analyzers/my_analyzer.py
```

```python
# analyzers/my_analyzer.py
class MyAnalyzer:
    def __init__(self, data):
        self.data = data
    
    def analyze(self):
        return {'result': 'value'}
```

2. **å»ºç«‹é é¢**
```bash
touch pages/page_my_feature.py
```

```python
# pages/page_my_feature.py
import streamlit as st
from analyzers.my_analyzer import MyAnalyzer

def render_my_feature_page():
    st.header("ğŸ†• æˆ‘çš„æ–°åŠŸèƒ½")
    
    if st.button("åŸ·è¡Œåˆ†æ"):
        analyzer = MyAnalyzer(data)
        result = analyzer.analyze()
        st.dataframe(result)
```

3. **è¨»å†Šåˆ° `pages/__init__.py`**
```python
from .page_my_feature import render_my_feature_page

__all__ = [
    'render_segment_page',
    'render_pace_page',
    'render_report_page',
    'render_racecard_page',
    'render_pace_prediction_page',
    'render_my_feature_page'  # â† æ–°å¢
]
```

4. **ä¿®æ”¹ `app.py`**
```python
from pages import render_my_feature_page

tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs([
    "ğŸ“Š åˆ†æ®µæ™‚é–“åˆ†æ",
    "ğŸ† è³½äº‹æ­¥é€Ÿåˆ†æ",
    "ğŸ“ˆ å®Œæ•´åˆ†æå ±å‘Š",
    "ğŸ‡ æ’ä½è¡¨åˆ†æ",
    "ğŸƒ è·‘æ³•é æ¸¬",
    "ğŸ†• æˆ‘çš„æ–°åŠŸèƒ½"  # â† æ–°å¢
])

with tab6:
    render_my_feature_page()  # â† æ–°å¢
```

5. **é‡å•Ÿ Streamlit**
```bash
# Ctrl+C åœæ­¢ï¼Œç„¶å¾Œ
streamlit run app.py
```

**é¢¨éšªè©•ä¼°**: ğŸŸ¢ **ä½é¢¨éšª** - å®Œå…¨ç¨ç«‹

---

### æ–¹æ¡ˆ Bï¼šæ“´å±•ç¾æœ‰ Tab

**é©ç”¨**: åœ¨ç¾æœ‰åŠŸèƒ½åŸºç¤ä¸Šå¢å¼·

**æ­¥é©Ÿ**:

1. **ç›´æ¥ä¿®æ”¹å°æ‡‰çš„é é¢**
```python
# pages/page_racecard.py
def render_racecard_page():
    # ... ç¾æœ‰ä»£ç¢¼ ...
    
    # æ–°å¢åŠŸèƒ½å€å¡Š
    if st.checkbox("é¡¯ç¤ºæ–°åŠŸèƒ½"):
        st.write("æ–°åŠŸèƒ½å…§å®¹")
```

2. **å¦‚æœéœ€è¦æ–°çš„åˆ†æå™¨**
```python
# pages/page_racecard.py
from analyzers.my_new_analyzer import MyNewAnalyzer

def render_racecard_page():
    # ... ç¾æœ‰ä»£ç¢¼ ...
    
    analyzer = MyNewAnalyzer(data)
    result = analyzer.analyze()
    st.write(result)
```

**é¢¨éšªè©•ä¼°**: ğŸŸ¡ **ä¸­é¢¨éšª** - å¯èƒ½å½±éŸ¿ç¾æœ‰ UI

---

## ğŸ”§ ä¿®æ”¹ç¾æœ‰åŠŸèƒ½æŒ‡å—

### æƒ…å¢ƒ 1ï¼šä¿®æ”¹ UI æ¨£å¼/æ–‡å­—

**å½±éŸ¿ç¯„åœ**: åªå½±éŸ¿é é¢å¤–è§€

**ä¿®æ”¹ä½ç½®**: `pages/page_*.py`

**æ­¥é©Ÿ**:
1. æ‰“é–‹å°æ‡‰çš„é é¢æª”æ¡ˆ
2. ä¿®æ”¹ Streamlit çµ„ä»¶ï¼ˆst.write, st.metric ç­‰ï¼‰
3. é‡æ–°å•Ÿå‹• Streamlit é è¦½

**é¢¨éšª**: ğŸŸ¢ **ä½é¢¨éšª**

**ç¯„ä¾‹**:
```python
# ä¿®æ”¹å‰
st.title("æ’ä½è¡¨åˆ†æ")

# ä¿®æ”¹å¾Œ
st.title("ğŸ‡ æ’ä½è¡¨åˆ†æ - å®Œæ•´ç‰ˆ")
```

---

### æƒ…å¢ƒ 2ï¼šä¿®æ”¹åˆ†æé‚è¼¯

**å½±éŸ¿ç¯„åœ**: å¯èƒ½å½±éŸ¿å¤šå€‹é é¢

**ä¿®æ”¹ä½ç½®**: `analyzers/*.py`

**æ­¥é©Ÿ**:
1. **å‚™ä»½åŸå§‹æª”æ¡ˆ**
```bash
cp analyzers/runstyle_predictor.py analyzers/runstyle_predictor.py.backup
```

2. **æŸ¥æ‰¾æ‰€æœ‰èª¿ç”¨ä½ç½®**
```bash
grep -r "RunstylePredictor" pages/
```

3. **ä¿®æ”¹é‚è¼¯**
```python
# analyzers/runstyle_predictor.py
class RunstylePredictor:
    def predict_running_style(self, horse_data):
        # ä¿®æ”¹é‚è¼¯
        pass
```

4. **æ¸¬è©¦æ‰€æœ‰ç›¸é—œåŠŸèƒ½**
- æ’ä½è¡¨é é¢ (page_racecard.py)
- è·‘æ³•é æ¸¬é é¢ (page_pace_prediction_integrated.py)

5. **å¦‚æœå‡ºéŒ¯ï¼Œå›æ»¾**
```bash
cp analyzers/runstyle_predictor.py.backup analyzers/runstyle_predictor.py
```

**é¢¨éšª**: ğŸ”´ **é«˜é¢¨éšª**

**æª¢æŸ¥æ¸…å–®**:
- [ ] å‚™ä»½åŸå§‹æª”æ¡ˆ
- [ ] æ‰¾åˆ°æ‰€æœ‰èª¿ç”¨ä½ç½®
- [ ] æ¸¬è©¦æ‰€æœ‰ç›¸é—œåŠŸèƒ½
- [ ] é©—è­‰è¼¸å…¥è¼¸å‡ºæ ¼å¼

---

### æƒ…å¢ƒ 3ï¼šä¿®æ”¹è³‡æ–™çˆ¬èŸ²é‚è¼¯

**å½±éŸ¿ç¯„åœ**: æ‰€æœ‰ä¾è³´çˆ¬èŸ²çš„åŠŸèƒ½

**ä¿®æ”¹ä½ç½®**: `analyzers/racecard_analyzer.py` æˆ– `analyzers/horse_racing_history_parser.py`

**å±éšªæ€§**: ğŸ”´ğŸ”´ğŸ”´ **æ¥µé«˜é¢¨éšª**

**æ­¥é©Ÿ**:
1. **å‚™ä»½å‚™ä»½å†å‚™ä»½**
```bash
cp analyzers/racecard_analyzer.py analyzers/racecard_analyzer.py.backup
cp analyzers/horse_racing_history_parser.py analyzers/horse_racing_history_parser.py.backup
```

2. **ä¿®æ”¹å‰æª¢æŸ¥é¦¬æœƒç¶²ç«™**
- æ’ä½è¡¨ HTML æ˜¯å¦æ”¹è®Š
- å¾€ç¸¾çˆ¬èŸ² URL æ˜¯å¦æ”¹è®Š
- æ•¸æ“šæ ¼å¼æ˜¯å¦æ”¹è®Š

3. **ä¿®æ”¹çˆ¬èŸ²ä»£ç¢¼**
```python
# ä½¿ç”¨ BeautifulSoup æª¢æŸ¥æ–°çš„ HTML çµæ§‹
soup = BeautifulSoup(response.content, 'html.parser')
# æ‰¾åˆ°æ–°çš„é¸æ“‡å™¨...
```

4. **é€æ­¥æ¸¬è©¦**
- å…ˆæ¸¬è©¦å–®å€‹é¦¬åŒ¹
- å†æ¸¬è©¦æ•´å€‹æ’ä½è¡¨
- é©—è­‰å¾€ç¸¾æ•¸æ“šå®Œæ•´æ€§

5. **é‡åˆ°å•é¡Œç«‹å³å›æ»¾**

**æª¢æŸ¥æ¸…å–®**:
- [ ] å¤šæ¬¡å‚™ä»½
- [ ] ç¢ºèªç¶²ç«™æ”¹ç‰ˆ
- [ ] ä¿®æ”¹çˆ¬èŸ²ä»£ç¢¼
- [ ] é€æ­¥æ¸¬è©¦
- [ ] é©—è­‰æ•¸æ“šæ ¼å¼

---

### æƒ…å¢ƒ 4ï¼šä¿®æ”¹è³‡æ–™æ ¼å¼è½‰æ›

**å½±éŸ¿ç¯„åœ**: é é¢å±¤å’Œé‚è¼¯å±¤ä¹‹é–“

**ä¿®æ”¹ä½ç½®**: `pages/page_pace_prediction_integrated.py` (è½‰æ›éƒ¨åˆ†)

**æ­¥é©Ÿ**:
1. **æ‰¾åˆ°è½‰æ›ä»£ç¢¼**
```python
# page_pace_prediction_integrated.py ä¸­çš„è½‰æ›é‚è¼¯
# å°‡çˆ¬èŸ²æ ¼å¼ â†’ é æ¸¬å™¨æ ¼å¼
horse_data = {
    'draw': safe_int_convert(horse.get('barrier')),  # â† è½‰æ›é‚è¼¯
    ...
}
```

2. **ä¿®æ”¹è½‰æ›é‚è¼¯**
```python
# ä¿®æ”¹å‰
'draw': int(horse.get('barrier') or 0)

# ä¿®æ”¹å¾Œï¼ˆå¦‚æœ barrier æ ¼å¼æ”¹è®Šï¼‰
'draw': int(horse.get('barrier').strip()) if horse.get('barrier') else 0
```

3. **é©—è­‰è½‰æ›çµæœ**
- æª¢æŸ¥æ—¥èªŒä¸­çš„æ•¸æ“šé¡å‹
- ç¢ºèªé æ¸¬å™¨èƒ½æ­£ç¢ºè™•ç†

**é¢¨éšª**: ğŸŸ¡ **ä¸­é¢¨éšª** - å½±éŸ¿é æ¸¬æº–ç¢ºåº¦

---

## ğŸ“ é–‹ç™¼è¦ç¯„

### 1. å‘½åè¦ç¯„

| é¡å‹ | æ ¼å¼ | ç¯„ä¾‹ |
|------|------|------|
| æª”æ¡ˆ | snake_case | `page_my_feature.py` |
| é¡åˆ¥ | PascalCase | `RaceCardAnalyzer` |
| å‡½æ•¸ | snake_case | `render_racecard_page()` |
| å¸¸æ•¸ | UPPER_CASE | `STANDARD_TIMES_DATA` |
| è®Šæ•¸ | snake_case | `horse_data` |

### 2. æª”æ¡ˆé ­éƒ¨æ ¼å¼

```python
# -*- coding: utf-8 -*-

"""
æ¨¡çµ„åŠŸèƒ½èªªæ˜ï¼ˆä¸­æ–‡ï¼‰
Module Description (English)

ç‰ˆæœ¬: v1.0
æ—¥æœŸ: 2026-01-09
ä½œè€…: Your Name
"""

import sys
import os
# ... å…¶ä»– import ...
```

### 3. Class è¦ç¯„

```python
class MyAnalyzer:
    """åˆ†æå™¨é¡èªªæ˜"""
    
    def __init__(self, data):
        """åˆå§‹åŒ–"""
        self.data = data
    
    def analyze(self):
        """åŸ·è¡Œåˆ†æ"""
        return result
```

### 4. å‡½æ•¸è¦ç¯„

```python
def render_my_page():
    """æ¸²æŸ“é é¢
    
    åŠŸèƒ½ï¼šxxx
    è¼¸å…¥ï¼šxxx
    è¼¸å‡ºï¼šxxx
    """
    pass
```

### 5. è¨»è§£è¦ç¯„

```python
# âœ… å¥½çš„è¨»è§£
if adjusted_pos <= 2.5:
    running_style = "FRONT"  # æ—©æ®µä½ç½®â‰¤2.5 åˆ†é¡ç‚ºé ˜æ”¾
    
# âŒ ä¸å¥½çš„è¨»è§£
if adjusted_pos <= 2.5:
    running_style = "FRONT"  # é€™æ˜¯é ˜æ”¾
```

### 6. Error Handling

```python
try:
    result = analyzer.fetch_racecard(...)
except requests.Timeout:
    st.error("âŒ ç¶²çµ¡è¶…æ™‚ï¼Œè«‹é‡è©¦")
except Exception as e:
    st.error(f"âŒ æœªé æœŸçš„éŒ¯èª¤: {str(e)}")
    logger.error(f"è©³ç´°: {traceback.format_exc()}")
```

---

## â“ å¸¸è¦‹å•é¡Œ

### Q1: ä¿®æ”¹å¾Œ Streamlit æ²’åæ‡‰ï¼Ÿ

**A**: 
1. æª¢æŸ¥ Python èªæ³• (Ctrl+Shift+P æª¢æŸ¥)
2. æŸ¥çœ‹çµ‚ç«¯çš„éŒ¯èª¤è¨Šæ¯
3. é‡æ–°å•Ÿå‹• Streamlit: `Ctrl+C` å¾Œ `streamlit run app.py`
4. æ¸…é™¤å¿«å–: `streamlit cache clear`

---

### Q2: Import éŒ¯èª¤ï¼šModuleNotFoundError?

**A**: 
- [ ] æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
- [ ] æª¢æŸ¥ `__init__.py` æ˜¯å¦å­˜åœ¨æ–¼ç›®éŒ„
- [ ] æª¢æŸ¥ `from` èªå¥çš„è·¯å¾‘æ˜¯å¦æ­£ç¢º
- [ ] é‡æ–°å•Ÿå‹• Streamlit

**æª¢æŸ¥æ¸…å–®**:
```bash
# æª”æ¡ˆæ‡‰è©²å­˜åœ¨
ls pages/__init__.py
ls analyzers/__init__.py
```

---

### Q3: é æ¸¬çµæœéŒ¯èª¤ï¼Ÿ

**A**: 
1. æª¢æŸ¥è³‡æ–™è½‰æ›
   - `barrier` æ˜¯å¦è½‰æ›ç‚ºæ•´æ•¸
   - `going` å­—æ®µæ˜¯å¦æ­£ç¢ºæå–

2. æŸ¥çœ‹è©³ç´°è¨ºæ–·
   - å±•é–‹ã€ŒğŸ” é æ¸¬éç¨‹è¨ºæ–·è©³æƒ…ã€
   - æª¢æŸ¥æ—©æ®µä½ç½®æ˜¯å¦æ­£ç¢ºè¨ˆç®—

3. é©—è­‰ç®—æ³•
   - æª¢æŸ¥æª”ä½ä¿®æ­£å€¼æ˜¯å¦æ­£ç¢º
   - æª¢æŸ¥åˆ†é¡é‚Šç•Œæ˜¯å¦åˆç†

4. åƒè€ƒå®Œæ•´æ¶æ§‹æ–‡æª”
   - `System_Architecture_Guide.md` çš„ã€Œè·‘æ³•é æ¸¬ç®—æ³•ã€éƒ¨åˆ†

---

### Q4: å¾€ç¸¾çˆ¬èŸ²è¶…æ™‚ï¼Ÿ

**A**: 
```python
# åœ¨ page_racecard.py ä¸­å¢åŠ è¶…æ™‚æ™‚é–“
analyzer = RaceCardAnalyzer(timeout=20, retry=5)
```

**åƒæ•¸èªªæ˜**:
- `timeout`: å–®æ¬¡è«‹æ±‚è¶…æ™‚ç§’æ•¸ï¼ˆé è¨­ 10ï¼‰
- `retry`: ç¸½é‡è©¦æ¬¡æ•¸ï¼ˆé è¨­ 3ï¼‰

---

### Q5: æœƒè©±ç‹€æ…‹æ±¡æŸ“ï¼ˆå¤šå ´æ¬¡é‡è¤‡é æ¸¬ï¼‰ï¼Ÿ

**A**: ç¢ºä¿ `clear_predictions()` è¢«èª¿ç”¨

```python
# pages/page_racecard.py
def clear_predictions():
    st.session_state.pop('pace_predictions', None)
    st.session_state.pop('pace_modified_predictions', None)

if fetch_button:
    clear_predictions()  # â† å¿…é ˆåœ¨çˆ¬å–å‰ï¼
    result = analyzer.fetch_racecard(...)
```

è©³è¦‹: `Session_State_Fix_v3.1_Guide.md`

---

### Q6: å¦‚ä½•å›æ»¾ä¿®æ”¹ï¼Ÿ

**A**: ä½¿ç”¨å‚™ä»½æª”æ¡ˆ
```bash
# å›æ»¾å–®å€‹æª”æ¡ˆ
cp analyzers/runstyle_predictor.py.backup analyzers/runstyle_predictor.py

# å›æ»¾æ•´å€‹ç›®éŒ„
cp -r analyzers.backup analyzers
```

---

## ğŸš€ å¿«é€Ÿåƒè€ƒ

### æ–°å¢ç¨ç«‹ Tab çš„æœ€å°ä»£ç¢¼

```python
# 1. analyzers/new.py
class NewAnalyzer:
    def analyze(self): return {}

# 2. pages/page_new.py
def render_new_page():
    st.write("Content")

# 3. pages/__init__.py
from .page_new import render_new_page
__all__ = [..., 'render_new_page']

# 4. app.py
from pages import render_new_page
with st.tabs(...)[-1]:
    render_new_page()
```

### ä¿®æ”¹ç¾æœ‰åŠŸèƒ½çš„æª¢æŸ¥è¡¨

```
â–¡ å‚™ä»½åŸå§‹æª”æ¡ˆ
â–¡ ç¢ºèªä¿®æ”¹ç¯„åœ
â–¡ æŸ¥æ‰¾æ‰€æœ‰èª¿ç”¨ä½ç½®
â–¡ ä¿®æ”¹ä»£ç¢¼
â–¡ æ¸¬è©¦æ‰€æœ‰ç›¸é—œåŠŸèƒ½
â–¡ é©—è­‰è¼¸å…¥è¼¸å‡ºæ ¼å¼
â–¡ æª¢æŸ¥æ—¥èªŒä¸­çš„éŒ¯èª¤
â–¡ æ–‡æª”åŒ–ä¿®æ”¹å…§å®¹
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

| æ–‡æª” | ç”¨é€” | ä½ç½® |
|------|------|------|
| **System_Architecture_Guide.md** | â­ å®Œæ•´ç³»çµ±æ¶æ§‹ | 30+ é  |
| **Session_State_Fix_v3.1_Guide.md** | æœƒè©±ç‹€æ…‹ä¿®å¾© | 10+ é  |
| **SYSTEM_ARCHITECTURE_SUMMARY.md** | å¿«é€Ÿåƒè€ƒ | 10+ é  |

---

## ğŸ“ é—œéµæé†’

### ğŸ”´ é«˜é¢¨éšªæ“ä½œ
- ä¿®æ”¹çˆ¬èŸ²é‚è¼¯ (`racecard_analyzer.py`, `horse_racing_history_parser.py`)
- ä¿®æ”¹æ ¸å¿ƒé æ¸¬å™¨ (`runstyle_predictor.py`)
- **å¿…é ˆå‚™ä»½ï¼** å¤šæ¬¡æ¸¬è©¦ï¼é€æ­¥æ¨é€²ï¼

### ğŸŸ¡ ä¸­é¢¨éšªæ“ä½œ
- ä¿®æ”¹åˆ†æé‚è¼¯ (`analyzers/*.py` ä¸­çš„å…¶ä»–æ–‡ä»¶)
- ä¿®æ”¹è³‡æ–™è½‰æ›é‚è¼¯
- **ç¢ºèªèª¿ç”¨ä½ç½®ï¼Œå®Œæ•´æ¸¬è©¦**

### ğŸŸ¢ ä½é¢¨éšªæ“ä½œ
- ä¿®æ”¹ UI ä½ˆå±€ (`pages/*.py`)
- æ–°å¢ç¨ç«‹ Tab
- ä¿®æ”¹é¡¯ç¤ºæ–‡å­—
- **ç°¡å–®æ¸¬è©¦å³å¯**

---

## ğŸ“ æ¨è–¦å­¸ç¿’è·¯å¾‘

1. **æ–°é–‹ç™¼è€…** 
   â†’ å…ˆè®€æœ¬æ–‡æª”
   â†’ å†è®€ `System_Architecture_Guide.md` çš„ã€Œç³»çµ±æ•´é«”æ¶æ§‹ã€éƒ¨åˆ†

2. **åŠŸèƒ½é–‹ç™¼è€…**
   â†’ è®€ã€Œæ–°å¢åŠŸèƒ½æŒ‡å—ã€
   â†’ åƒè€ƒã€Œå¿«é€Ÿåƒè€ƒã€
   â†’ æŒ‰ç…§ã€Œé–‹ç™¼è¦ç¯„ã€ç·¨ç¢¼

3. **ç¶­è­·äººå“¡**
   â†’ è®€ã€Œä¿®æ”¹ç¾æœ‰åŠŸèƒ½æŒ‡å—ã€
   â†’ è¨˜ä½ã€Œé—œéµæé†’ã€ä¸­çš„é¢¨éšªç­‰ç´š
   â†’ éµå¾ªã€Œæª¢æŸ¥æ¸…å–®ã€

---

**æ–‡æª”ç‰ˆæœ¬**: v12.0  
**æœ€å¾Œæ›´æ–°**: 2026-01-09  
**é…å¥—æ–‡æª”**: System_Architecture_Guide.md  

**é‡è¦æé†’**: 
- ğŸ”´ ä¿®æ”¹å‰å‹™å¿…å‚™ä»½
- ğŸŸ¡ ä¿®æ”¹å¾Œå‹™å¿…æ¸¬è©¦
- ğŸŸ¢ é‡åˆ°å•é¡Œç«‹å³å›æ»¾

---
